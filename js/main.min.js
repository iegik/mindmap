(()=>{var J=a=>{let{children:e}=a;return`<div class="whiteboard">${Array.isArray(e)?e.join(""):e||""}</div>`},D=J;var $=class{toString(){let e=Math.round(Math.random()*1e6).toString(36);return this.id=this.id||`ref-${e}`}get current(){return document.querySelector(`[ref=${this.id}]`)}},p=()=>new $;var W=a=>{let{children:e,className:t,title:r,onClick:i}=a,s=p();return setTimeout(()=>{i&&s.current.addEventListener("click",i)}),`<button class="${t} btn" ref="${s}" title="${r}">${e}</button>`},A=W;var Z=a=>{let{children:e,className:t=""}=a,r=Array.isArray(e)?e.join(""):e||"";return`<div class="${t} card">${r}</div>`},K=Z;var V=a=>{let{value:e,className:t="",onChange:r,multiline:i}=a,s=p();return setTimeout(()=>{r&&(s.current.addEventListener("input",r),s.current.addEventListener("blur",r))}),i?`<textarea class="${t} text-input text-input--multiline" ref="${s}">${e}</textarea>`:`<input class="${t} text-input" value="${e}" ref="${s}" />`},w=V;var q="Hello, World!",z="Mindmap example",F="\u2192",G="\u2193",Q="\u2715",X="Drag item to move",Y="Add node",ee="Add subnode",m={greetings:q,title:z,add_node:F,add_subnode:G,remove_node:Q,move_title:X,add_node_title:Y,add_subnode_title:ee};var te=a=>{let{children:e,value:t,button:r,card:i,text:s,onAddChild:n,onAddSibling:u,onRemoveChild:S,onMoveChild:l,onChange:k,hasParent:y,allowNext:c,itemId:o,draggable:x=!1}=a,_=p(),H=Array.isArray(e)?e.join(""):e||"";setTimeout(()=>{x&&l&&(_.current.addEventListener("dragstart",j=>{j.dataTransfer.setData("text/plain",JSON.stringify({itemId:o}))}),_.current.addEventListener("drop",l))});let v=[];y&&v.push(r({children:m.add_subnode,title:m.add_subnode_title,className:"mindMapItem__addSubNode",onClick:u})),c&&v.push(r({children:m.add_node,title:m.add_node_title,className:"mindMapItem__addNode",onClick:n})),c&&v.push(r({children:m.remove_node,title:m.remove_node_title,className:"mindMapItem__removeNode",onClick:S}));let U=i({children:[s({value:t,onChange:k,multiline:!0,className:"mindMapItem__input"}),...v]});return`
    <div class="mindMapItem">
      <div class="mindMapItem__value" ref="${_}"  draggable="${x}">
        ${U}
      </div>
      <div class="mindMapItem__dropArea"></div>
      <div class="mindMapItem__subitems">
        ${H}
      </div>
    </div>
  `},R=te;var L=class{constructor(){this.setItem=(e,t)=>(this.Data[e]=t,this.Data[e]);this.getItem=e=>this.Data[e];this.removeItem=e=>{if(this.Data[e]!==void 0){for(var t=0;t<this.Structure.length;t++)this.Structure[t].itemId===e&&this.removeNode(this.Structure[t]._id);return delete this.Data[e],!0}else return!1};this.addRoot=e=>(this.Data[e]!==void 0&&(this.removeNodes(),this.Structure.push({_id:1,lkey:1,rkey:2,depth:1,childs:0,parentId:0,itemId:e})),this.Structure[0]._id);this.getRoot=()=>this.getNodes()[0];this.getMaxId=()=>this.Structure.reduce((e,{_id:t})=>e>t?e:t,-1/0);this.addNode=(e,t)=>{if(this.Data[t]!==void 0){var r=this.getNode(e,!0);if(!r)return!1;var i=this.getMaxId();return this.Structure=this.Structure.map(s=>(s.lkey>r.rkey&&(s.lkey+=2,s.rkey+=2),s.rkey>=r.rkey&&s.lkey<r.rkey&&(s.rkey+=2,s.childs++),s)),this.Structure.push({_id:i+1,lkey:r.rkey,rkey:r.rkey+1,depth:r.depth+1,childs:0,parentId:r._id,itemId:t}),i+1}};this.getNode=(e,t)=>{var r=this.Structure.filter(i=>i._id===e);return Array.isArray(r)&&r.length===1?t===!0?{...r[0]}:r[0]:!1};this.removeNode=e=>{var t=this.getNode(e,!0),r=this.getChilds(e).length+1;return t?(this.Structure=this.getNodes().map(i=>(i.rkey>t.rkey&&i.lkey<t.lkey&&(i.childs=i.childs-r),i)).filter(i=>!(i.lkey>=t.lkey&&i.rkey<=t.rkey)).map(i=>(i.rkey>t.rkey&&(i.lkey=i.lkey>t.lkey?i.lkey-(t.rkey-t.lkey+1):i.lkey,i.rkey=i.rkey-(t.rkey-t.lkey+1)),i)),this.Structure):!1};this.moveNode=(e,t)=>{var r=this.getNode(e,!0),i=this.getNode(t,!0),s=r.depth,n=r.rkey,u=r.lkey,S=i.depth,l=i.rkey-1,k=S-s+1,y=n-u+1,c;l>n?(c=l-u+1-y,this.Structure=this.Structure.map(o=>(o.lkey<=l&&o.rkey>u&&(o.rkey<=n?o.lkey=o.lkey+c:o.lkey>n&&(o.lkey=o.lkey-y),o.rkey<=n&&(o.depth=o.depth+k),o.rkey<=n?o.rkey=o.rkey+c:o.rkey<=l&&(o.rkey=o.rkey-y)),o))):(c=l-u+1,this.Structure=this.Structure.map(o=>(o.rkey>l&&o.lkey<n&&(o.lkey>=u?o.rkey=o.rkey+c:o.rkey<u&&(o.rkey=o.rkey+y),o.lkey>=u&&(o.depth=o.depth+k),o.lkey>=u?o.lkey=o.lkey+c:o.lkey>l&&(o.lkey=o.lkey+y)),o)))};this.getNodes=()=>this.Structure.sort((e,t)=>e.lkey-t.lkey);this.removeNodes=()=>{this.Structure=[]};this.getParent=e=>{var t=this.getParents(e);return t[t.length-1]===void 0?!1:t[t.length-1]};this.getParents=e=>{var t=this.getNode(e,!0);return t?this.getNodes().filter(r=>r.lkey<t.lkey&&r.rkey>t.rkey).map(r=>(r.data=this.Data[r.itemId],r)):[]};this.getChilds=(e,t)=>{var r=this.getNode(e,!0);return r?this.getNodes().filter(i=>i.lkey>=r.lkey&&i.rkey<=r.rkey&&e!==i._id&&(t===void 0?!0:i.depth<=r.depth+t)).map(i=>(i.data=this.Data[i.itemId],i)):[]};this.getBranch=e=>{var t=this.getNode(e);return t?this.getNodes().filter(r=>r.rkey>t.lkey&&r.lkey<t.rkey).map(r=>(r.data=this.Data[r.itemId],r)):[]};this.getTree=()=>this.getNodes().map(e=>(e.data=this.Data[e.itemId],e));this.clearAll=()=>{this.Structure=[],this.Data={}};this.isRoot=e=>{var t=this.getNode(e);return t&&t.parentId===0};this.isBranch=e=>{var t=this.getNode(e);return t&&t.childs>0};this.isLeaf=e=>{var t=this.getNode(e);return t&&t.childs===0};this.getMaxRightKey=()=>this.Structure.reduce((e,{rkey:t})=>e>t?e:t,-1/0);this.getMaxLeftKey=()=>this.Structure.reduce((e,{lkey:t})=>e>t?e:t,-1/0);this.getCountNodes=()=>this.Structure.length;this.checkTree=()=>{var e=this.Structure.filter(s=>s.lkey>=s.rkey),t=this.Structure.filter(s=>(s.rkey-s.lkey)%2===0),r=this.Structure.filter(s=>(s.lkey-s.depth+2)%2===1),i=[];return e.length!==0&&i.push({LeftLessRight:e}),t.length!==0&&i.push({ModKeys:t}),r.length!==0&&i.push({Depth:r}),i};this.debug=()=>this.getNodes().map(e=>`${String(" ").repeat(e.depth+1)}> ${JSON.stringify(this.Data[e.itemId])}(itemId:${e.itemId}; nodeId:${e._id}; lkey:${e.lkey}; rkey:${e.rkey}; depth:${e.depth}; childs:${e.childs})`).join(`
`);this.Structure=[],this.Data={}}},E=L;var d=new E,g,b,M=a=>{let[e=[],t={}]=a||[];d.Structure=e,d.Data=t},re=()=>{g=[],b=[]},ie=a=>{let e=new Uint16Array(a.length);for(let t=0;t<e.length;t++)e[t]=a.charCodeAt(t);return btoa(String.fromCharCode(...new Uint8Array(e.buffer)))},ae=a=>{binary=atob(a);let e=new Uint8Array(binary.length);for(let t=0;t<e.length;t++)e[t]=binary.charCodeAt(t);return String.fromCharCode(...new Uint16Array(e.buffer))},I=a=>ie(JSON.stringify(a,null,2)),N=(a,e="{}")=>JSON.parse(a?ae(a):e),C="save",T="mind-map-item",B=()=>{let a=localStorage.getItem(T);return N(a,"{}")},oe=()=>{let a=B()||{},{[C]:e}=a,{data:t}=e||{};return t},O=()=>{let a=I([d.Structure,d.Data]);g.push(a);let e=B(),{[C]:t,...r}=e;localStorage.setItem(T,I({...r,[C]:{data:a}}))},se=()=>{g.length!==0&&(b.push(I([d.Structure,d.Data])),M(N(g.pop(),"[]")),f())},de=()=>{b.length!==0&&(g.push(I([d.Structure,d.Data])),M(N(b.pop(),"[]")),f())};(async()=>{let a=await navigator.keyboard.getLayoutMap(),e;(r=>r[r.DOM_VK_Z=a.get("KeyZ")]="DOM_VK_Z")(e||={}),document.addEventListener("keydown",t=>{if(t.stopImmediatePropagation(),t.key===e.DOM_VK_Z&&(t.metaKey||t.ctrlKey)&&t.shiftKey)return de();if(t.key===e.DOM_VK_Z&&(t.metaKey||t.ctrlKey))return se()})})();var f=()=>{document.getElementById("root").innerHTML=D({children:[P(d.getRoot()?.itemId)]})},P=(a=1)=>{d.getRoot()||(d.setItem(a,"<new>"),d.addRoot(a));let e=d.getChilds(a,1),t=d.getItem(a),r=d.getParent(a);return R({value:t,children:e.map(i=>P(i.itemId)),button:A,card:K,text:w,itemId:a,draggable:!0,onAddChild:i=>{let s=d.getMaxId()+1;d.setItem(s,"<new>"),d.addNode(a,s),f()},onAddSibling:i=>{let s=d.getMaxId()+1;d.setItem(s,"<new>"),d.addNode(r.itemId,s),f()},onRemoveChild:i=>{d.removeItem(a),f()},onMoveChild:i=>{i.preventDefault();let s=JSON.parse(i.dataTransfer.getData("text/plain"));try{d.moveNode(+s.itemId,a),O()}catch(n){alert(n.message)}f()},onChange:i=>{d.setItem(a,i.target.value),O()},hasParent:r!==!1,allowNext:!0})};document.title=m.title;re();M(N(oe(),"[]"));f();})();
//# sourceMappingURL=main.min.js.map
